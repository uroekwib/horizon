{% doc %}
  @prompt
    Create an enhanced collapsible accordion section with FAQ topic chip navigation. Add a row of rounded clickable chips at the top of the section, where each chip is labeled with the corresponding accordion item's heading. When a chip is clicked, it should smoothly scroll to the matching accordion item and automatically expand it. Include an active state for the currently opened accordion chip. The chips should wrap to multiple lines on mobile devices. Preserve all existing accordion functionality including the heading and content fields for each item. Use vanilla JavaScript scoped to the section only, with scoped CSS for the chip navigation UI. The accordion structure and content editing workflow must remain unchanged.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-faq-accordion-{{ ai_gen_id }} {
    display: block;
    width: {{ block.settings.desktop_width_percent }}%;
    max-width: 100%;
  }

  .ai-faq-chips-{{ ai_gen_id }} {
    display: flex;
    flex-wrap: wrap;
    gap: {{ block.settings.chip_gap }}px;
    margin-bottom: {{ block.settings.chips_spacing }}px;
  }

  .ai-faq-chip-{{ ai_gen_id }} {
    padding: {{ block.settings.chip_padding_vertical }}px {{ block.settings.chip_padding_horizontal }}px;
    background-color: {{ block.settings.chip_background }};
    color: {{ block.settings.chip_text_color }};
    border: {{ block.settings.chip_border_width }}px solid {{ block.settings.chip_border_color }};
    border-radius: {{ block.settings.chip_border_radius }}px;
    font-size: {{ block.settings.chip_font_size }}px;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
  }

  .ai-faq-chip-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.chip_hover_background }};
    color: {{ block.settings.chip_hover_text_color }};
    border-color: {{ block.settings.chip_hover_border_color }};
  }

  .ai-faq-chip-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.chip_active_background }};
    color: {{ block.settings.chip_active_text_color }};
    border-color: {{ block.settings.chip_active_border_color }};
  }

  .ai-faq-items-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: {{ block.settings.accordion_gap }}px;
  }

  .ai-faq-item-{{ ai_gen_id }} {
    border: {{ block.settings.accordion_border_width }}px solid {{ block.settings.accordion_border_color }};
    border-radius: {{ block.settings.accordion_border_radius }}px;
    overflow: hidden;
    background-color: {{ block.settings.accordion_background }};
  }

  .ai-faq-header-{{ ai_gen_id }} {
    width: 100%;
    padding: {{ block.settings.accordion_padding }}px;
    background-color: {{ block.settings.accordion_header_background }};
    color: {{ block.settings.accordion_header_text_color }};
    border: none;
    text-align: left;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: {{ block.settings.accordion_heading_size }}px;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }

  .ai-faq-header-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.accordion_header_hover_background }};
  }

  .ai-faq-icon-{{ ai_gen_id }} {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .ai-faq-item-{{ ai_gen_id }}.open .ai-faq-icon-{{ ai_gen_id }} {
    transform: rotate(180deg);
  }

  .ai-faq-content-{{ ai_gen_id }} {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .ai-faq-content-inner-{{ ai_gen_id }} {
    padding: 0 {{ block.settings.accordion_padding }}px {{ block.settings.accordion_padding }}px;
    color: {{ block.settings.accordion_content_text_color }};
    font-size: {{ block.settings.accordion_content_size }}px;
    line-height: 1.6;
  }

  @media screen and (max-width: 749px) {
    .ai-faq-accordion-{{ ai_gen_id }} {
      width: 100%;
    }

    .ai-faq-chip-{{ ai_gen_id }} {
      font-size: {{ block.settings.chip_font_size | times: 0.9 }}px;
    }

    .ai-faq-header-{{ ai_gen_id }} {
      font-size: {{ block.settings.accordion_heading_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<faq-accordion-{{ ai_gen_id }} class="ai-faq-accordion-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% if block.settings.show_chips %}
    <div class="ai-faq-chips-{{ ai_gen_id }}">
      {% if block.settings.item_1_heading != blank %}
        <button class="ai-faq-chip-{{ ai_gen_id }}" data-target="item-1" type="button">
          {{ block.settings.item_1_heading }}
        </button>
      {% endif %}
      {% if block.settings.item_2_heading != blank %}
        <button class="ai-faq-chip-{{ ai_gen_id }}" data-target="item-2" type="button">
          {{ block.settings.item_2_heading }}
        </button>
      {% endif %}
      {% if block.settings.item_3_heading != blank %}
        <button class="ai-faq-chip-{{ ai_gen_id }}" data-target="item-3" type="button">
          {{ block.settings.item_3_heading }}
        </button>
      {% endif %}
      {% if block.settings.item_4_heading != blank %}
        <button class="ai-faq-chip-{{ ai_gen_id }}" data-target="item-4" type="button">
          {{ block.settings.item_4_heading }}
        </button>
      {% endif %}
      {% if block.settings.item_5_heading != blank %}
        <button class="ai-faq-chip-{{ ai_gen_id }}" data-target="item-5" type="button">
          {{ block.settings.item_5_heading }}
        </button>
      {% endif %}
    </div>
  {% endif %}

  <div class="ai-faq-items-{{ ai_gen_id }}">
    {% if block.settings.item_1_heading != blank %}
      <div class="ai-faq-item-{{ ai_gen_id }}" data-item-id="item-1">
        <button class="ai-faq-header-{{ ai_gen_id }}" aria-expanded="false" type="button">
          <span>{{ block.settings.item_1_heading }}</span>
          <svg class="ai-faq-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="ai-faq-content-{{ ai_gen_id }}">
          <div class="ai-faq-content-inner-{{ ai_gen_id }}">
            {{ block.settings.item_1_content }}
          </div>
        </div>
      </div>
    {% endif %}

    {% if block.settings.item_2_heading != blank %}
      <div class="ai-faq-item-{{ ai_gen_id }}" data-item-id="item-2">
        <button class="ai-faq-header-{{ ai_gen_id }}" aria-expanded="false" type="button">
          <span>{{ block.settings.item_2_heading }}</span>
          <svg class="ai-faq-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="ai-faq-content-{{ ai_gen_id }}">
          <div class="ai-faq-content-inner-{{ ai_gen_id }}">
            {{ block.settings.item_2_content }}
          </div>
        </div>
      </div>
    {% endif %}

    {% if block.settings.item_3_heading != blank %}
      <div class="ai-faq-item-{{ ai_gen_id }}" data-item-id="item-3">
        <button class="ai-faq-header-{{ ai_gen_id }}" aria-expanded="false" type="button">
          <span>{{ block.settings.item_3_heading }}</span>
          <svg class="ai-faq-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="ai-faq-content-{{ ai_gen_id }}">
          <div class="ai-faq-content-inner-{{ ai_gen_id }}">
            {{ block.settings.item_3_content }}
          </div>
        </div>
      </div>
    {% endif %}

    {% if block.settings.item_4_heading != blank %}
      <div class="ai-faq-item-{{ ai_gen_id }}" data-item-id="item-4">
        <button class="ai-faq-header-{{ ai_gen_id }}" aria-expanded="false" type="button">
          <span>{{ block.settings.item_4_heading }}</span>
          <svg class="ai-faq-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="ai-faq-content-{{ ai_gen_id }}">
          <div class="ai-faq-content-inner-{{ ai_gen_id }}">
            {{ block.settings.item_4_content }}
          </div>
        </div>
      </div>
    {% endif %}

    {% if block.settings.item_5_heading != blank %}
      <div class="ai-faq-item-{{ ai_gen_id }}" data-item-id="item-5">
        <button class="ai-faq-header-{{ ai_gen_id }}" aria-expanded="false" type="button">
          <span>{{ block.settings.item_5_heading }}</span>
          <svg class="ai-faq-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="ai-faq-content-{{ ai_gen_id }}">
          <div class="ai-faq-content-inner-{{ ai_gen_id }}">
            {{ block.settings.item_5_content }}
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</faq-accordion-{{ ai_gen_id }}>

<script>
  (function() {
    class FaqAccordion{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.chips = this.querySelectorAll('.ai-faq-chip-{{ ai_gen_id }}');
        this.items = this.querySelectorAll('.ai-faq-item-{{ ai_gen_id }}');
        this.headers = this.querySelectorAll('.ai-faq-header-{{ ai_gen_id }}');
        this.currentOpenItem = null;
      }

      connectedCallback() {
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.chips.forEach((chip) => {
          chip.addEventListener('click', () => {
            const targetId = chip.getAttribute('data-target');
            const targetItem = this.querySelector(`[data-item-id="${targetId}"]`);
            
            if (targetItem) {
              this.scrollToItem(targetItem);
              this.openItem(targetItem);
              this.updateActiveChip(chip);
            }
          });
        });

        this.headers.forEach((header) => {
          header.addEventListener('click', () => {
            const item = header.closest('.ai-faq-item-{{ ai_gen_id }}');
            this.toggleItem(item);
          });
        });
      }

      scrollToItem(item) {
        const offset = 100;
        const itemPosition = item.getBoundingClientRect().top + window.pageYOffset - offset;
        
        window.scrollTo({
          top: itemPosition,
          behavior: 'smooth'
        });
      }

      openItem(item) {
        if (this.currentOpenItem && this.currentOpenItem !== item) {
          this.closeItem(this.currentOpenItem);
        }

        const content = item.querySelector('.ai-faq-content-{{ ai_gen_id }}');
        const header = item.querySelector('.ai-faq-header-{{ ai_gen_id }}');
        const contentInner = content.querySelector('.ai-faq-content-inner-{{ ai_gen_id }}');
        
        item.classList.add('open');
        header.setAttribute('aria-expanded', 'true');
        content.style.maxHeight = contentInner.scrollHeight + 'px';
        
        this.currentOpenItem = item;
      }

      closeItem(item) {
        const content = item.querySelector('.ai-faq-content-{{ ai_gen_id }}');
        const header = item.querySelector('.ai-faq-header-{{ ai_gen_id }}');
        
        item.classList.remove('open');
        header.setAttribute('aria-expanded', 'false');
        content.style.maxHeight = '0';
        
        if (this.currentOpenItem === item) {
          this.currentOpenItem = null;
        }
      }

      toggleItem(item) {
        if (item.classList.contains('open')) {
          this.closeItem(item);
          this.clearActiveChip();
        } else {
          this.openItem(item);
          const itemId = item.getAttribute('data-item-id');
          const chip = this.querySelector(`.ai-faq-chip-{{ ai_gen_id }}[data-target="${itemId}"]`);
          if (chip) {
            this.updateActiveChip(chip);
          }
        }
      }

      updateActiveChip(activeChip) {
        this.chips.forEach((chip) => {
          chip.classList.remove('active');
        });
        activeChip.classList.add('active');
      }

      clearActiveChip() {
        this.chips.forEach((chip) => {
          chip.classList.remove('active');
        });
      }
    }

    customElements.define('faq-accordion-{{ ai_gen_id }}', FaqAccordion{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "FAQ accordion with chips",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Chip navigation"
    },
    {
      "type": "checkbox",
      "id": "show_chips",
      "label": "Show topic chips",
      "default": true
    },
    {
      "type": "range",
      "id": "chip_gap",
      "label": "Gap between chips",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "chips_spacing",
      "label": "Spacing below chips",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "chip_padding_vertical",
      "label": "Chip vertical padding",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "chip_padding_horizontal",
      "label": "Chip horizontal padding",
      "min": 8,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "chip_font_size",
      "label": "Chip font size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "chip_border_radius",
      "label": "Chip border radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "chip_border_width",
      "label": "Chip border width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "header",
      "content": "Chip colors"
    },
    {
      "type": "color",
      "id": "chip_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "chip_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "chip_border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "chip_hover_background",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "chip_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "chip_hover_border_color",
      "label": "Hover border",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "chip_active_background",
      "label": "Active background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "chip_active_text_color",
      "label": "Active text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "chip_active_border_color",
      "label": "Active border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Accordion style"
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "range",
      "id": "accordion_gap",
      "label": "Gap between items",
      "min": 4,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "accordion_padding",
      "label": "Item padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "accordion_border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "accordion_border_width",
      "label": "Border width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "range",
      "id": "accordion_heading_size",
      "label": "Heading size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "accordion_content_size",
      "label": "Content size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "header",
      "content": "Accordion colors"
    },
    {
      "type": "color",
      "id": "accordion_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accordion_border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "accordion_header_background",
      "label": "Header background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accordion_header_hover_background",
      "label": "Header hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "accordion_header_text_color",
      "label": "Header text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "accordion_content_text_color",
      "label": "Content text",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Item 1"
    },
    {
      "type": "text",
      "id": "item_1_heading",
      "label": "Heading",
      "default": "What are your shipping options?"
    },
    {
      "type": "richtext",
      "id": "item_1_content",
      "label": "Content",
      "default": "<p>We offer standard and express shipping options. Standard shipping takes 5-7 business days, while express shipping takes 2-3 business days.</p>"
    },
    {
      "type": "header",
      "content": "Item 2"
    },
    {
      "type": "text",
      "id": "item_2_heading",
      "label": "Heading",
      "default": "What is your return policy?"
    },
    {
      "type": "richtext",
      "id": "item_2_content",
      "label": "Content",
      "default": "<p>We accept returns within 30 days of purchase. Items must be unused and in original packaging.</p>"
    },
    {
      "type": "header",
      "content": "Item 3"
    },
    {
      "type": "text",
      "id": "item_3_heading",
      "label": "Heading",
      "default": "Do you ship internationally?"
    },
    {
      "type": "richtext",
      "id": "item_3_content",
      "label": "Content",
      "default": "<p>Yes, we ship to most countries worldwide. Shipping costs and delivery times vary by location.</p>"
    },
    {
      "type": "header",
      "content": "Item 4"
    },
    {
      "type": "text",
      "id": "item_4_heading",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "item_4_content",
      "label": "Content"
    },
    {
      "type": "header",
      "content": "Item 5"
    },
    {
      "type": "text",
      "id": "item_5_heading",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "item_5_content",
      "label": "Content"
    }
  ],
  "presets": [
    {
      "name": "FAQ accordion with chips"
    }
  ]
}
{% endschema %}